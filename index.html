<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H2TechService ERP Pro 2026</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --h2-blue: #004085; --h2-light: #007bff; --h2-dark: #2c3e50;
            --bg-light: #f4f7f6; --text-light: #333; --card-light: white;
        }
        [data-theme="dark"] {
            --bg-light: #121212; --text-light: #e0e0e0; --card-light: #1e1e1e;
            background: #121212 !important; color: #e0e0e0 !important;
        }
        body { 
            background: var(--bg-light); color: var(--text-light); 
            font-family: 'Segoe UI', sans-serif; font-size: 10px; margin: 0; 
            display: flex; min-height: 100vh;
        }
        .sidebar { 
            width: 170px; background: linear-gradient(180deg, #1e2d3f, #2c3e50);
            height: 100vh; position: fixed; left: 0; top: 0; 
            display: flex; flex-direction: column; padding: 15px 10px; gap: 8px; z-index: 1000;
        }
        .sidebar button { 
            font-size: 10px; padding: 10px; border-radius: 8px; border: none; 
            width: 100%; color: white; background: rgba(255,255,255,0.1);
            display: flex; flex-direction: column; align-items: center; cursor: pointer;
        }
        .sidebar button:hover { background: var(--h2-light); }
        .main-wrapper { margin-left: 170px; flex-grow: 1; padding: 10px; display: flex; justify-content: center; }
        
        .invoice-box { 
            width: 210mm; height: 297mm; background: var(--card-light); 
            display: flex; flex-direction: column; box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        .header-bar { background: linear-gradient(135deg, var(--h2-blue), var(--h2-light)); color: white; padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; }
        .content { padding: 15px 25px; flex-grow: 1; display: flex; flex-direction: column; }
        
        #cust-display span { display: block; line-height: 1.3; }

        .table { font-size: 9.5px; width: 100%; table-layout: fixed; border-collapse: collapse; margin-top: 10px; }
        .table th, .table td { border: 1px solid #dee2e6; padding: 5px; vertical-align: middle; }
        .col-desc { width: 40%; } .col-qty { width: 6%; } .col-price { width: 10%; } .col-tax-p { width: 6%; } .col-tax-e { width: 18%; } .col-total { width: 18%; } .col-action { width: 2%; }
        
        .totals-box { background: var(--h2-dark); color: white; padding: 10px; border-radius: 8px; }
        .desc-input { width: 100%; border: none; background: transparent; resize: none; font-size: 9.5px; }
        input.form-control-sm { border: none; background: transparent; text-align: center; width: 100%; color: inherit; }

        /* WICHTIG: ENTFERNT KOPF- UND FUSSZEILEN BEIM DRUCKEN */
        @page {
            size: A4;
            margin: 0; /* Entfernt die Browser-Texte an den Ecken */
        }
        @media print { 
            body { background: white !important; }
            .sidebar, .no-print { display: none !important; } 
            .main-wrapper { margin: 0; padding: 0; } 
            .invoice-box { width: 210mm; height: 297mm; box-shadow: none; margin: 0; border: none; } 
        }
    </style>
</head>
<body>

    <div class="sidebar no-print">
        <button onclick="saveInvoice()"><span>üíæ</span><span>Speichern</span></button>
        <button onclick="openCustomerModal()"><span>üë•</span><span>Kunden</span></button>
        <button onclick="openStats()"><span>üìä</span><span>Bilanz</span></button>
        <button onclick="toggleDarkMode()"><span>üåô</span><span>Design</span></button>
        <button onclick="document.getElementById('logo-trigger').click()"><span>üñºÔ∏è</span><span>Logo</span></button>
        <button onclick="openArchive()"><span>üìÇ</span><span>Archiv</span></button>
        <button onclick="window.print()"><span>üñ®Ô∏è</span><span>Drucken</span></button>
        <button onclick="exportPDF()"><span>üìÑ</span><span>PDF Export</span></button>
    </div>

    <div class="main-wrapper">
        <div id="pdf-area" class="invoice-box">
            <div class="header-bar">
                <div>
                    <img id="logo-display" src="" style="max-height: 50px; display: block;">
                    <h2 class="m-0">H2TechService</h2><small>Osman Tuncer</small>
                </div>
                <h1 class="m-0" style="letter-spacing: 3px;">RECHNUNG</h1>
            </div>
            <div class="content">
                <div class="row">
                    <div class="col-6">
                        <small class="text-primary fw-bold">ABSENDER</small><br>
                        <strong>H2TechService</strong><br>
                        Suntalstra√üe 48<br>
                        31552 Rodenberg<br>
                        üìß 74star@gmail.com<br>
                        üìû +49 176 66658777<br>
                        <b>Steuer-ID: 41/320/887966</b>
                    </div>
                    <div class="col-6 text-end">
                        <b>Nr:</b> <span id="inv-nr" contenteditable="true">H2-2026-001</span><br>
                        <b>Datum:</b> <span id="inv-date"></span><br><br>
                        <small class="text-primary fw-bold">EMPF√ÑNGER</small>
                        <div id="cust-display" class="fw-bold text-dark mt-1">Kunde w√§hlen...</div>
                    </div>
                </div>

                <table class="table">
                    <thead class="table-light">
                        <tr class="text-center">
                            <th class="col-desc">Beschreibung</th>
                            <th class="col-qty">Stk</th>
                            <th class="col-price">‚Ç¨</th>
                            <th class="col-tax-p">%</th>
                            <th class="col-tax-e">MwSt (‚Ç¨)</th>
                            <th class="col-total">Gesamt (‚Ç¨)</th>
                            <th class="col-action no-print"></th>
                        </tr>
                    </thead>
                    <tbody id="inv-items"></tbody>
                </table>
                <button class="btn btn-sm btn-outline-primary no-print mt-2" onclick="addRow()">+ Zeile</button>

                <div class="row mt-auto pt-3 border-top">
                    <div class="col-7"><div class="p-2 border rounded small"><strong>Bank:</strong> Osman Tuncer<br>IBAN: LT78 3250 0925 1892 8659<br>BIC: REVOLT21</div></div>
                    <div class="col-5 totals-box">
                        <div class="d-flex justify-content-between"><span>Netto:</span><span id="sum-n">0,00 ‚Ç¨</span></div>
                        <div class="d-flex justify-content-between"><span>MwSt:</span><span id="sum-t">0,00 ‚Ç¨</span></div>
                        <hr class="my-1 border-white opacity-25">
                        <div class="d-flex justify-content-between fw-bold"><span>GESAMT:</span><span id="sum-g">0,00 ‚Ç¨</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <input type="file" id="logo-trigger" class="d-none" onchange="saveLogo()">
    
    <div class="modal fade" id="modal-cust" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h6>Kundenverwaltung</h6><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body">
        <input type="text" id="c-name" class="form-control mb-1" placeholder="Name/Firma">
        <input type="text" id="c-street" class="form-control mb-1" placeholder="Stra√üe">
        <input type="text" id="c-city" class="form-control mb-1" placeholder="PLZ Ort">
        <input type="text" id="c-mail" class="form-control mb-1" placeholder="E-Mail">
        <input type="text" id="c-phone" class="form-control mb-1" placeholder="Telefon">
        <button class="btn btn-primary w-100 mt-2" onclick="addCustomer()">Speichern</button><hr><div id="cust-list" class="list-group"></div>
    </div></div></div></div>

    <div class="modal fade" id="modal-stats" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h6>üìä Bilanz & Ausgaben</h6><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body">
        <div class="row text-center">
            <div class="col-6 mb-2"><div class="card p-2 bg-success text-white">Umsatz (Brutto)<br><b id="st-brutto">0,00 ‚Ç¨</b></div></div>
            <div class="col-6 mb-2"><div class="card p-2 bg-info text-white">MwSt f√§llig<br><b id="st-tax">0,00 ‚Ç¨</b></div></div>
            <div class="col-12"><div class="card p-2 bg-danger text-white">Ausgaben (‚Ç¨)<br>
                <input type="number" id="st-exp-input" class="form-control form-control-sm text-center bg-white text-dark" oninput="saveExpenses()" step="0.01">
            </div></div>
            <div class="col-12 mt-2"><div class="card p-2 bg-dark text-white">Gewinn (Netto - Ausgaben)<br><b id="st-profit">0,00 ‚Ç¨</b></div></div>
        </div>
    </div></div></div></div>

    <div class="modal fade" id="modal-archive" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h6>Archiv</h6><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><table class="table"><thead><tr><th>Nr.</th><th>Datum</th><th>Betrag</th><th>Aktion</th></tr></thead><tbody id="archive-list"></tbody></table></div></div></div></div>

    <script>
        let db = JSON.parse(localStorage.getItem('h2_erp_final_2026') || '{"invoices":[],"customers":[],"logo":"","expenses":0,"theme":"light"}');
        
        function formatEUR(v) { return v.toLocaleString('de-DE', {minimumFractionDigits:2, maximumFractionDigits:2}) + ' ‚Ç¨'; }
        
        function addRow(desc='', qty=1, price=0, tax=19) {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td class="col-desc"><textarea class="desc-input" oninput="calc()">${desc}</textarea></td>
                <td><input type="number" class="form-control-sm qt" value="${qty}" oninput="calc()"></td>
                <td><input type="number" class="form-control-sm pr" value="${price}" oninput="calc()"></td>
                <td><input type="number" class="form-control-sm tx" value="${tax}" oninput="calc()"></td>
                <td class="text-center mw-e">0,00 ‚Ç¨</td><td class="text-center fw-bold gs-e">0,00 ‚Ç¨</td>
                <td class="no-print text-center"><button onclick="this.closest('tr').remove();calc()" class="btn text-danger btn-sm p-0">√ó</button></td>`;
            document.getElementById('inv-items').appendChild(tr); calc();
        }

        function calc() {
            let n=0, t=0, g=0;
            document.querySelectorAll('#inv-items tr').forEach(r => {
                let q = parseFloat(r.querySelector('.qt').value)||0, p = parseFloat(r.querySelector('.pr').value)||0, tx = parseFloat(r.querySelector('.tx').value)||0;
                let ln = q*p, lt = ln*(tx/100), lg = ln+lt;
                r.querySelector('.mw-e').textContent = formatEUR(lt); r.querySelector('.gs-e').textContent = formatEUR(lg);
                n+=ln; t+=lt; g+=lg;
            });
            document.getElementById('sum-n').textContent = formatEUR(n); document.getElementById('sum-t').textContent = formatEUR(t); document.getElementById('sum-g').textContent = formatEUR(g);
        }

        function addCustomer() {
            const c = { 
                n: document.getElementById('c-name').value, 
                s: document.getElementById('c-street').value, 
                z: document.getElementById('c-city').value,
                m: document.getElementById('c-mail').value,
                p: document.getElementById('c-phone').value
            };
            if(c.n) { db.customers.push(c); localStorage.setItem('h2_erp_final_2026', JSON.stringify(db)); renderCustomers(); }
        }

        function renderCustomers() {
            const l = document.getElementById('cust-list'); l.innerHTML = '';
            db.customers.forEach((c, i) => l.innerHTML += `<button class="list-group-item list-group-item-action" onclick="selectCust(${i})">${c.n}</button>`);
        }

        function selectCust(i) {
            const c = db.customers[i];
            document.getElementById('cust-display').innerHTML = `<span>${c.n}</span><span>${c.s}</span><span>${c.z}</span><span>${c.m}</span><span>${c.p}</span>`;
            bootstrap.Modal.getInstance(document.getElementById('modal-cust')).hide();
        }

        function openStats() {
            let br = 0, tx = 0, ne = 0;
            db.invoices.forEach(i => { br += i.gross; tx += i.tax; ne += i.net; });
            document.getElementById('st-brutto').textContent = formatEUR(br);
            document.getElementById('st-tax').textContent = formatEUR(tx);
            document.getElementById('st-exp-input').value = db.expenses;
            document.getElementById('st-profit').textContent = formatEUR(ne - db.expenses);
            new bootstrap.Modal(document.getElementById('modal-stats')).show();
        }

        function saveExpenses() {
            db.expenses = parseFloat(document.getElementById('st-exp-input').value) || 0;
            localStorage.setItem('h2_erp_final_2026', JSON.stringify(db));
            openStats();
        }

        function saveInvoice() {
            const inv = {
                nr: document.getElementById('inv-nr').textContent,
                date: document.getElementById('inv-date').textContent,
                gross: parseFloat(document.getElementById('sum-g').textContent.replace(/[^\d,]/g,'').replace(',','.')),
                tax: parseFloat(document.getElementById('sum-t').textContent.replace(/[^\d,]/g,'').replace(',','.')),
                net: parseFloat(document.getElementById('sum-n').textContent.replace(/[^\d,]/g,'').replace(',','.'))
            };
            db.invoices.push(inv); localStorage.setItem('h2_erp_final_2026', JSON.stringify(db)); alert('Rechnung archiviert!');
        }

        function openArchive() {
            new bootstrap.Modal(document.getElementById('modal-archive')).show();
            const l = document.getElementById('archive-list'); l.innerHTML = '';
            db.invoices.forEach((i, idx) => l.innerHTML += `<tr><td>${i.nr}</td><td>${i.date}</td><td>${formatEUR(i.gross)}</td><td><button class="btn btn-sm btn-danger" onclick="deleteInv(${idx})">üóëÔ∏è</button></td></tr>`);
        }

        function deleteInv(idx) { db.invoices.splice(idx, 1); localStorage.setItem('h2_erp_final_2026', JSON.stringify(db)); openArchive(); }

        function toggleDarkMode() {
            db.theme = db.theme === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', db.theme);
            localStorage.setItem('h2_erp_final_2026', JSON.stringify(db));
        }

        function saveLogo() {
            const f = document.getElementById('logo-trigger').files[0];
            const reader = new FileReader();
            reader.onload = (e) => { db.logo = e.target.result; document.getElementById('logo-display').src = db.logo; localStorage.setItem('h2_erp_final_2026', JSON.stringify(db)); };
            reader.readAsDataURL(f);
        }

        function exportPDF() {
            html2pdf().from(document.getElementById('pdf-area')).set({margin: 0, filename: 'Rechnung.pdf', jsPDF: {unit:'mm', format:'a4', orientation:'portrait'}}).save();
        }

        function openCustomerModal() { new bootstrap.Modal(document.getElementById('modal-cust')).show(); renderCustomers(); }

        document.getElementById('inv-date').textContent = new Date().toLocaleDateString('de-DE');
        document.getElementById('logo-display').src = db.logo || "";
        document.body.setAttribute('data-theme', db.theme);
        addRow('IT-Service & Support', 1, 0, 19);
    </script>
</body>
</html>
