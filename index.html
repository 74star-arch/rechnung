<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>H2 TechService Rechnung</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
@media print {
  .no-print, .admin-only { display:none !important; }
  body { background:white }
}
body { background:#f8fafc; font-family:'Segoe UI',sans-serif }
.card { max-width:900px; margin:20px auto; background:white; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.1) }
.header-bg { background:#1e40af; color:white; padding:30px }
textarea { resize:none }
</style>
</head>

<body class="pb-20">
<div class="card">

<!-- HEADER -->
<div class="header-bg flex justify-between">
<div>
<h1 class="text-3xl font-black">H2 TechService</h1>
<p class="opacity-80">Osman Tuncer</p>
</div>
<div class="text-right">
<p class="text-xl">Rechnung</p>
<input id="inv" class="bg-transparent text-right font-bold text-white">
</div>
</div>

<!-- ADRESSEN -->
<div class="p-6 grid grid-cols-2 gap-6 text-sm">
<div>
<b>Absender</b>
<p>H2 TechService</p>
<p>Suntal Str. 48</p>
<p>31552 Rodenberg</p>
<p>üìû <a href="tel:+4917666658777">+49 176 66658777</a></p>
<p>‚úâÔ∏è <a href="mailto:74star@gmail.com">74star@gmail.com</a></p>
<p>Steuernr.: 41320887966</p>
</div>

<div class="text-right">
<b>Empf√§nger</b>

<select id="customerSelect" class="admin-only w-full mb-1 p-1 border"
onchange="loadCustomer()">
<option value="">‚Äî Kunde ausw√§hlen ‚Äî</option>
</select>

<textarea id="customerData"
class="w-full border p-2"
placeholder="Kundendaten"></textarea>

<div class="admin-only mt-1 text-xs">
<button onclick="saveCustomer()">üíæ speichern</button>
<button onclick="deleteCustomer()">üóë l√∂schen</button>
</div>

<p class="mt-2">
Datum: <input type="date" id="date"><br>
F√§llig: <input type="date" id="due">
</p>
</div>
</div>

<!-- POSITIONEN -->
<table class="w-full text-sm border-t">
<thead class="bg-slate-100">
<tr>
<th class="p-2 text-left">Beschreibung</th>
<th class="p-2 w-20">Menge</th>
<th class="p-2 w-32">Preis ‚Ç¨</th>
<th class="p-2 w-32">Gesamt ‚Ç¨</th>
</tr>
</thead>

<tbody id="rows">
<tr>
<td class="p-2">
<textarea class="w-full p-1 desc" rows="2"
oninput="autoGrow(this)"></textarea>
</td>
<td class="p-2">
<input type="number" min="1" max="10000" value="1"
class="qty w-16 text-center" oninput="upd()">
</td>
<td class="p-2">
<input type="number" class="price w-full text-right" oninput="upd()">
</td>
<td class="p-2 text-right font-bold row-total">0.00 ‚Ç¨</td>
</tr>
</tbody>
</table>

<button onclick="addRow()" class="admin-only m-3 text-blue-600">
+ Neue Position
</button>

<!-- SUMMEN -->
<div class="p-6 grid grid-cols-2 border-t bg-slate-50">
<div>
<p><b>Zahlungsinformationen</b></p>
<p>IBAN: LT83 2500 9251 8928 659</p>
<p>BIC: Revolut21</p>
</div>

<div>
<p>Netto: <span id="sub">0.00 ‚Ç¨</span></p>
<p>MwSt 19%: <span id="tax">0.00 ‚Ç¨</span></p>
<p class="text-xl font-bold">Gesamt: <span id="total">0.00 ‚Ç¨</span></p>
</div>
</div>
</div>

<!-- AKTIONEN -->
<div class="fixed bottom-6 left-1/2 -translate-x-1/2 flex gap-3 no-print">
<button onclick="sendPDF()" class="bg-blue-600 text-white px-6 py-3 rounded">PDF</button>
<button onclick="sendMail()" class="bg-green-600 text-white px-6 py-3 rounded">E-Mail</button>
<button onclick="share()" class="bg-emerald-600 text-white px-6 py-3 rounded">WhatsApp</button>
  <button onclick="share()" class="bg-blue-600 text-white px-6 py-3 round">Telegramp</button>
</div>

<script>
// ===== Admin Sichtbarkeit =====
function hideAdmin(){
 document.querySelectorAll('.admin-only').forEach(e=>e.style.display='none');
}
function showAdmin(){
 document.querySelectorAll('.admin-only').forEach(e=>e.style.display='');
}

// ===== Rechnungsnummer =====
let n = localStorage.getItem("inv")||0;
n++; localStorage.setItem("inv",n);
inv.value = "RE-" + new Date().getFullYear()+"-"+String(n).padStart(3,"0");

// ===== Datum =====
date.valueAsDate = new Date();
let d=new Date(); d.setDate(d.getDate()+14); due.valueAsDate=d;

// ===== Positionen =====
const VAT=0.19;
function upd(){
 let s=0;
 document.querySelectorAll("#rows tr").forEach(r=>{
  let q=r.querySelector(".qty").value||0;
  let p=r.querySelector(".price").value||0;
  let t=q*p;
  r.querySelector(".row-total").innerText=t.toFixed(2)+" ‚Ç¨";
  s+=t;
 });
 sub.innerText=s.toFixed(2)+" ‚Ç¨";
 tax.innerText=(s*VAT).toFixed(2)+" ‚Ç¨";
 total.innerText=(s*1.19).toFixed(2)+" ‚Ç¨";
}

function addRow(){
 const tr=document.createElement("tr");
 tr.innerHTML=document.querySelector("#rows tr").innerHTML;
 rows.appendChild(tr);
}

function autoGrow(el){
 el.style.height="auto";
 el.style.height=(el.scrollHeight)+"px";
}

// ===== Kunden =====
let customers=JSON.parse(localStorage.getItem("cust")||"[]");
function refresh(){
 customerSelect.innerHTML='<option value="">‚Äî Kunde ausw√§hlen ‚Äî</option>';
 customers.forEach((c,i)=>{
  let o=document.createElement("option");
  o.value=i; o.textContent=c.split("\n")[0];
  customerSelect.appendChild(o);
 });
}
function saveCustomer(){
 customers.push(customerData.value);
 localStorage.setItem("cust",JSON.stringify(customers));
 refresh();
}
function deleteCustomer(){
 customers.splice(customerSelect.value,1);
 localStorage.setItem("cust",JSON.stringify(customers));
 refresh();
 customerData.value="";
}
function loadCustomer(){
 customerData.value=customers[customerSelect.value]||"";
}
refresh();

// ===== Aktionen =====
function sendPDF(){
 hideAdmin(); window.print(); setTimeout(showAdmin,500);
}
function sendMail(){
 hideAdmin();
 location.href="mailto:?subject=Rechnung "+inv.value;
 setTimeout(showAdmin,500);
}
function share(){
 hideAdmin();
 navigator.share?.({title:"Rechnung",text:"Rechnung "+inv.value});
 setTimeout(showAdmin,500);
}
</script>

</body>
</html>
