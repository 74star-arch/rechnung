<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>H2 TechService Rechnung</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>

<style>
@media print {
  .no-print { display:none !important }
}
textarea { resize: vertical }
</style>
</head>

<body class="bg-slate-100 p-4">

<div class="max-w-4xl mx-auto bg-white shadow-xl rounded-xl overflow-hidden">

<!-- HEADER -->
<div class="bg-blue-900 text-white p-6 flex justify-between">
  <div>
    <h1 class="text-2xl font-black">H2 TechService</h1>
    <p>Osman Tuncer</p>
    <p>Tel: +49 176 66658777</p>
    <p>E-Mail: 74star@gmail.com</p>
  </div>
  <div class="text-right">
    <h2 class="text-xl">RECHNUNG</h2>
    <div id="invoiceNr" class="font-bold"></div>
  </div>
</div>

<!-- KUNDE -->
<div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">

<div>
  <h3 class="font-bold mb-2">EmpfÃ¤nger</h3>

  <!-- ADMIN -->
  <div class="no-print mb-2">
    <select id="customerSelect" class="w-full p-2 border" onchange="loadCustomer()">
      <option value="">Kunde auswÃ¤hlen</option>
    </select>
    <button onclick="saveCustomer()" class="text-blue-600 text-sm">ðŸ’¾ Speichern</button>
    <button onclick="deleteCustomer()" class="text-red-600 text-sm ml-2">ðŸ—‘ LÃ¶schen</button>
  </div>

  <textarea id="customerData" class="w-full h-28 border p-2"></textarea>
</div>

<div class="text-right">
  Datum: <input type="date" id="date"><br>
  FÃ¤llig: <input type="date" id="due">
</div>
</div>

<!-- POSITIONEN -->
<div class="p-6">
<table class="w-full text-sm border">
<thead class="bg-slate-100">
<tr>
  <th class="p-2 text-left">Beschreibung</th>
  <th class="p-2 w-20">Menge</th>
  <th class="p-2 w-24">Preis â‚¬</th>
  <th class="p-2 w-24">Gesamt</th>
</tr>
</thead>
<tbody id="rows">
<tr>
  <td class="p-2">
    <textarea class="w-full h-20 desc"></textarea>
  </td>
  <td class="p-2">
    <input type="number" min="1" max="10000" value="1" class="qty w-full" oninput="calc()">
  </td>
  <td class="p-2">
    <input type="number" step="0.01" class="price w-full" oninput="calc()">
  </td>
  <td class="p-2 font-bold rowTotal">0.00 â‚¬</td>
</tr>
</tbody>
</table>

<button onclick="addRow()" class="no-print mt-2 text-blue-600">+ Position</button>
</div>

<!-- SUMME -->
<div class="p-6 bg-slate-50">
<div class="flex justify-between"><span>Netto</span><span id="netto">0.00 â‚¬</span></div>
<div class="flex justify-between"><span>MwSt 19%</span><span id="mwst">0.00 â‚¬</span></div>
<div class="flex justify-between text-xl font-black border-t pt-2"><span>GESAMT</span><span id="total">0.00 â‚¬</span></div>
</div>

<!-- ACTIONS -->
<div class="p-6 text-center no-print space-x-3">
<button onclick="window.print()" class="bg-blue-700 text-white px-4 py-2 rounded">PDF</button>

<a id="mailBtn" class="bg-gray-700 text-white px-4 py-2 rounded">Mail</a>
<a id="waBtn" class="bg-green-600 text-white px-4 py-2 rounded">WhatsApp</a>
<a id="tgBtn" class="bg-sky-600 text-white px-4 py-2 rounded">Telegram</a>
</div>

</div>

<script>
// RECHNUNGSNUMMER
let nr = localStorage.getItem("h2_nr") || 0;
nr++; localStorage.setItem("h2_nr", nr);
invoiceNr.innerText = "RE-" + new Date().getFullYear() + "-" + String(nr).padStart(3,"0");

// DATUM
const t=new Date(), d=new Date(); d.setDate(t.getDate()+14);
date.valueAsDate=t; due.valueAsDate=d;

// POSITIONEN
function addRow(){
  rows.insertAdjacentHTML("beforeend", rows.children[0].outerHTML);
}
function calc(){
  let sum=0;
  document.querySelectorAll("#rows tr").forEach(r=>{
    let q=r.querySelector(".qty").value||0;
    let p=r.querySelector(".price").value||0;
    let t=q*p;
    r.querySelector(".rowTotal").innerText=t.toFixed(2)+" â‚¬";
    sum+=t;
  });
  netto.innerText=sum.toFixed(2)+" â‚¬";
  mwst.innerText=(sum*0.19).toFixed(2)+" â‚¬";
  total.innerText=(sum*1.19).toFixed(2)+" â‚¬";

  const txt = "Rechnung " + invoiceNr.innerText + " Gesamt: " + total.innerText;
  mailBtn.href="mailto:?subject=Rechnung&body="+encodeURIComponent(txt);
  waBtn.href="https://wa.me/?text="+encodeURIComponent(txt);
  tgBtn.href="https://t.me/share/url?text="+encodeURIComponent(txt);
}

// KUNDEN
let customers=JSON.parse(localStorage.getItem("h2_customers"))||[];
function refresh(){
  customerSelect.innerHTML='<option value="">Kunde auswÃ¤hlen</option>';
  customers.forEach((c,i)=>{
    let o=document.createElement("option");
    o.value=i; o.textContent=c.split("\n")[0];
    customerSelect.appendChild(o);
  });
}
function saveCustomer(){
  customers.push(customerData.value);
  localStorage.setItem("h2_customers",JSON.stringify(customers));
  refresh();
}
function loadCustomer(){
  customerData.value=customers[customerSelect.value]||"";
}
function deleteCustomer(){
  if(customerSelect.value==="")return;
  customers.splice(customerSelect.value,1);
  localStorage.setItem("h2_customers",JSON.stringify(customers));
  refresh(); customerData.value="";
}
refresh();
</script>

</body>
</html>
