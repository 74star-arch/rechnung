<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>H2 TechService Rechnung</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
@media print {
  .no-print { display:none !important }
}
textarea { resize:vertical; min-height:60px }
.qty { max-width:70px }
</style>
</head>

<body class="bg-slate-100 pb-24">

<div class="max-w-4xl mx-auto bg-white mt-6 rounded-xl shadow-xl p-6">

<!-- HEADER -->
<div class="flex justify-between items-start border-b pb-4">
<div>
<h1 class="text-2xl font-black">H2 TechService</h1>
<p>Inhaber: Osman Tuncer</p>
<p>Tel: +49 176 66658777</p>
<p>E-Mail: 74star@gmail.com</p>
<p class="text-sm text-slate-500">Steuernr.: 41320887966</p>
</div>

<div class="text-right">
<p class="text-xl font-bold">RECHNUNG</p>
<input id="inv" class="font-bold text-right">
</div>
</div>

<!-- EMPFÃ„NGER -->
<div class="mt-6">
<b>EmpfÃ¤nger</b>

<select id="customerSelect" class="w-full p-2 bg-slate-100 admin-only"
onchange="loadCustomer()">
<option value="">â€” Kunde auswÃ¤hlen â€”</option>
</select>

<textarea id="customerData"
class="w-full bg-slate-50 p-2 mt-2"
placeholder="Kundendaten"></textarea>

<button onclick="saveCustomer()"
class="admin-only mt-2 text-blue-600 font-bold">
ðŸ’¾ Kunde speichern
</button>
</div>

<!-- DATUM -->
<div class="mt-4 text-sm">
Datum: <input type="date" id="date">
FÃ¤llig: <input type="date" id="due">
</div>

<!-- POSITIONEN -->
<table class="w-full mt-6 text-sm border">
<thead class="bg-slate-100">
<tr>
<th>Beschreibung</th>
<th>Menge</th>
<th>Preis â‚¬</th>
<th>Gesamt â‚¬</th>
</tr>
</thead>

<tbody id="rows">
<tr>
<td>
<textarea class="w-full desc"
placeholder="Leistungsbeschreibung"
oninput="autoGrow(this)"></textarea>
</td>
<td>
<input type="number" value="1" min="1" max="10000"
class="qty text-center" oninput="upd()">
</td>
<td>
<input type="number" class="price text-right" oninput="upd()">
</td>
<td class="row-total text-right font-bold">0.00 â‚¬</td>
</tr>
</tbody>
</table>

<button onclick="add()" class="admin-only mt-2 text-blue-600">
+ Position
</button>

<!-- SUMMEN -->
<div class="mt-6 text-right">
<p>Netto: <span id="sub">0.00 â‚¬</span></p>
<p>MwSt 19%: <span id="tax">0.00 â‚¬</span></p>
<p class="text-2xl font-black">GESAMT: <span id="total">0.00 â‚¬</span></p>
</div>

<!-- TEILEN -->
<div class="mt-6 flex gap-4 no-print">
<button onclick="sendMail()" class="bg-blue-600 text-white px-4 py-2 rounded">
ðŸ“§ Mail
</button>
<button onclick="sendWhatsApp()" class="bg-green-600 text-white px-4 py-2 rounded">
ðŸŸ¢ WhatsApp
</button>
<button onclick="sendTelegram()" class="bg-sky-500 text-white px-4 py-2 rounded">
ðŸ”µ Telegram
</button>
<button onclick="window.print()" class="bg-black text-white px-4 py-2 rounded">
ðŸ“„ PDF
</button>
</div>

</div>

<script>
// RECHNUNGSNUMMER
let nr = localStorage.getItem("h2_inv") || 0;
nr++;
localStorage.setItem("h2_inv", nr);
inv.value = "RE-2025-" + String(nr).padStart(3,"0");

// DATUM
const t=new Date(),d=new Date();d.setDate(t.getDate()+14);
date.valueAsDate=t; due.valueAsDate=d;

// POSITIONEN
const VAT=0.19;
function upd(){
let s=0;
document.querySelectorAll("#rows tr").forEach(r=>{
let q=r.querySelector(".qty").value||0;
let p=r.querySelector(".price").value||0;
let t=q*p;
r.querySelector(".row-total").innerText=t.toFixed(2)+" â‚¬";
s+=t;
});
sub.innerText=s.toFixed(2)+" â‚¬";
tax.innerText=(s*VAT).toFixed(2)+" â‚¬";
total.innerText=(s*1.19).toFixed(2)+" â‚¬";
}

function add(){
rows.insertAdjacentHTML("beforeend",`
<tr>
<td><textarea class="w-full desc" oninput="autoGrow(this)"></textarea></td>
<td><input type="number" value="1" min="1" max="10000"
class="qty text-center" oninput="upd()"></td>
<td><input type="number" class="price text-right" oninput="upd()"></td>
<td class="row-total text-right font-bold">0.00 â‚¬</td>
</tr>`);
}

function autoGrow(t){ t.style.height="auto"; t.style.height=t.scrollHeight+"px"; }

// KUNDEN
let customers=JSON.parse(localStorage.getItem("h2_customers"))||[];
function saveCustomer(){
customers.push(customerData.value);
localStorage.setItem("h2_customers",JSON.stringify(customers));
refresh();
}
function loadCustomer(){
customerData.value=customers[customerSelect.value];
}
function refresh(){
customerSelect.innerHTML=`<option value="">â€” Kunde auswÃ¤hlen â€”</option>`;
customers.forEach((c,i)=>{
customerSelect.innerHTML+=`<option value="${i}">${c.split("\n")[0]}</option>`;
});
}
refresh();

// TEILEN
function sendMail(){
location.href=`mailto:?subject=Rechnung ${inv.value}&body=Siehe Rechnung`;
}
function sendWhatsApp(){
window.open("https://wa.me/?text=Rechnung "+inv.value);
}
function sendTelegram(){
window.open("https://t.me/share/url?text=Rechnung "+inv.value);
}
</script>

</body>
</html>
